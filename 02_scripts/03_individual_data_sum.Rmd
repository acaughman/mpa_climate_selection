---
title: "Data Summarizing"
author: "Allie Caughman"
date: "2023-01-02"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

library(tidyverse)
```

### Read in CSV

```{r}
output_df <- read_csv(here::here("03_generated_data", "model_outputs", "model6.csv"))

gc()
```

### Manipulate data

```{r}
# Summarize pop size and frequency by genotype
geno_sum2 <- output_df %>%
  filter(age == "adult") %>% 
  group_by(lat, lon, generation, rep, genotype) %>%
  summarise(geno_pop_sum = sum(pop, na.rm = TRUE))

geno_mean2 <- geno_sum2 %>% 
  group_by(lat, lon, generation, genotype) %>%
  summarise(geno_pop_mean = mean(geno_pop_sum, na.rm=TRUE),
            geno_pop_sd = sd(geno_pop_sum, na.rm=TRUE)) %>% 
  ungroup() %>% 
  mutate(geno_pop_se = geno_pop_sd / sqrt(10))

rm(geno_sum2)

pop_sum2 <- output_df %>%
  filter(age == "adult") %>% 
  group_by(lat, lon, generation, rep) %>%
  summarise(pop_sum = sum(pop, na.rm = TRUE), 
            max_temp = max_temp, 
            min_temp = min_temp,
            fished_sum = sum(fished))

rm(output_df)

pop_mean2 <- pop_sum2 %>%
  group_by(lat, lon, generation) %>%
  summarise(pop_mean = mean(pop_sum, na.rm = TRUE), 
            pop_sd = sd(pop_sum, na.rm = TRUE),
            max_temp = max_temp, 
            min_temp = min_temp,
            fished_mean = mean(fished_sum, na.rm=TRUE)) %>% 
  ungroup() %>% 
  mutate(pop_se = pop_sd / sqrt(10))

rm(pop_sum2)

gc()
gc()
gc()

output_sum2 <- full_join(geno_mean2, pop_mean2)

rm(pop_mean2, geno_mean2)

gc()
gc()
gc()

output_sum2 = output_sum2 %>%
  distinct() %>% 
  mutate(freq = geno_pop_mean / pop_mean,
         mpa_size = "Small",
         climate = "Null",
         evolution = "No")

write_csv(output_sum2, here::here("03_generated_data", "summary_data", "summary_m6.csv"))

rm(list=ls())

gc()

beepr::beep(5)
```

